
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />

    <script type="text/javascript" src="scripts/easeljs.min.js"></script>
    <script type="text/javascript" src="scripts/eventemitter2.min.js"></script>
    <script type="text/javascript" src="scripts/roslib.min.js"></script>
    <script type="text/javascript" src="scripts/ros2d.min.js"></script>
    <script type="text/javascript" src="scripts/nav2d.js"></script>
    <script type="text/javascript" src="scripts/ros3d.min.js"></script>
    <script type="text/javascript" src="scripts/blockly/blockly_compressed.js"></script>
    <script type="text/javascript" src="scripts/blockly/blocks_compressed.js"></script>
    <script type="text/javascript" src="scripts/blockly/python_compressed.js"></script>
    <script type="text/javascript" src="scripts/blockly/msg/js/en.js"></script>
    <script type="text/javascript" src="scripts/blockly/msg/messages.js"></script>





    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="/js/jquery.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="/js/bootstrap.js"></script>

    <script src="scripts/axios.min.js"></script>


    <script src="/js/bootstrap-toggle.min.js"></script>
    <script src="/js/nipplejs.min.js"></script>
    <script src="/js/dataTables.dataTables.min.js"></script>
    <script src="/js/bootstrap-table.min.js"></script>
    <script src="/js/Chart.min.js"></script>
    <script type='text/javascript' src="scripts/GaugeMeter.js"></script>
    <script type='text/javascript' src="scripts/gauge.js"></script>


    <link rel="stylesheet" href="/css/bootstrap-table.min.css">
    <link rel="stylesheet" href="/css/Chart.min.css">
    <link rel="stylesheet" href="/css/bootstrap-toggle.min.css">
    <link rel="stylesheet" href="/css/jquery.dataTables.css">


    <style>
        body {
            background-color: linen;
        }

        .table tbody tr.highlight td {
            background-color: #ddd;
        }


        .GaugeMeter {
            Position: Relative;
            Text-Align: Center;
            Overflow: Hidden;
            Cursor: Default;
        }

        .GaugeMeter SPAN,
        .GaugeMeter B {
            Margin: 0 10%;
            Width: 80%;
            Position: Absolute;
            Text-align: Center;
            Display: Inline-Block;
            Color: RGBa(0, 0, 0, .8);
            Font-Weight: 100;
            Font-Family: "Open Sans", Arial;
            Overflow: Hidden;
            White-Space: NoWrap;
            Text-Overflow: Ellipsis;
        }

        .GaugeMeter[data-style="Semi"] B {
            Margin: 0 10%;
            Width: 100%;
        }

        .GaugeMeter S,
        .GaugeMeter U {
            Text-Decoration: None;
            Font-Size: .5em;
            Opacity: .5;
        }

        .GaugeMeter B {
            Color: Black;
            Font-Weight: 300;
            Font-Size: .5em;
            Opacity: .8;
        }


        #exTab1 .tab-content {
            color: white;
            background-color: #428bca;
            padding: 5px 15px;
        }

        #exTab2 h3 {
            color: white;
            background-color: #428bca;
            padding: 5px 15px;
        }

        /* remove border radius for the tab */

        #exTab1 .nav-pills>li>a {
            border-radius: 0;
        }

        /* change border radius for the tab , apply corners on top*/

        #exTab3 .nav-pills>li>a {
            border-radius: 4px 4px 0 0;
        }

        #exTab3 .tab-content {
            color: white;
            background-color: #428bca;
            padding: 5px 15px;
        }

        .well {
            background: none;
        }

        table {
            overflow: hidden;
        }

        tr:hover {
            background-color: #ffa;
        }

        td,
        th {
            position: relative;
        }

        td:hover::after,
        th:hover::after {
            content: "";
            position: absolute;
            background-color: #ffa;
            left: 0;
            top: -5000px;
            height: 10000px;
            width: 100%;
            z-index: -1;
        }

        .span3 {
            height: 30% !important;
            overflow: scroll;
        }

        .span5 {
            height: 50% !important;
            overflow: scroll;
        }
    </style>

    <script type="text/javascript" type="text/javascript">
        /**
         * Setup all visualization elements when the page is loaded.
         */
        //const axios  = new axios()


        var ip = ""
        var rosConn;
        var mapTable = $('#mapTable')
        var mapname = "map"
        var manager = null
        var twist;
        var cmdVel;
        var publishImmidiately = true;
        var selectedMapName = "tmp"
        var seqWayPoint = 1
        var wpointname;
        var gmap_name = "Choose a map"
        var gwaypoint_name = ""
        var g_waypoints = [{
            name: "None"
        }]
        var g_pose
        var listener
        var gauge_lin
        var time = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        // For drawing the lines
        var imuData = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        var angularVelocity = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        var myChart = null
        var colWidth = 0
        //var viewer3d = null
        var workspace = null
        var blocklyDiv = null
        var blocklyArea = null

        var isMapChoosen = false
        var isWaypointAvaliable = false


        function createJoystick() {
            // Check if joystick was aready created
            if (manager == null) {
                joystickContainer = document.getElementById('joystick');
                // joystck configuration, if you want to adjust joystick, refer to:
                // https://yoannmoinet.github.io/nipplejs/
                var options = {
                    zone: joystickContainer,
                    position: {
                        left: 50 + '%',
                        top: 105 + 'px'
                    },
                    mode: 'static',
                    size: 200,
                    color: '#0066ff',
                    restJoystick: true
                };
                manager = nipplejs.create(options);
                // event listener for joystick move
                manager.on('move', function (evt, nipple) {
                    // nipplejs returns direction is screen coordiantes
                    // we need to rotate it, that dragging towards screen top will move robot forward
                    var direction = nipple.angle.degree - 90;
                    if (direction > 180) {
                        direction = -(450 - nipple.angle.degree);
                    }
                    // convert angles to radians and scale linear and angular speed
                    // adjust if youwant robot to drvie faster or slower
                    var lin = Math.cos(direction / 57.29) * nipple.distance * 0.001;
                    var ang = Math.sin(direction / 57.29) * nipple.distance * 0.01;
                    // nipplejs is triggering events when joystic moves each pixel
                    // we need delay between consecutive messege publications to 
                    // prevent system from being flooded by messages
                    // events triggered earlier than 50ms after last publication will be dropped 
                    if (publishImmidiately) {
                        publishImmidiately = false;
                        moveAction(lin, ang);
                        setTimeout(function () {
                            publishImmidiately = true;
                        }, 50);
                    }
                });
                // event litener for joystick release, always send stop message
                manager.on('end', function () {
                    moveAction(0, 0);
                });
            }
        }

        function moveAction(linear, angular) {
            if (linear !== undefined && angular !== undefined) {
                twist.linear.x = linear;
                twist.angular.z = angular;
            } else {
                twist.linear.x = 0;
                twist.angular.z = 0;
            }
            cmdVel.publish(twist);
        }



        //function init() {
        $(document).ready(function () {
            //axios = require('axios')
            //console.log(axios)

            colWidth = document.body.offsetWidth
            console.log("colWidth")
            console.log(colWidth)

            var tt = {}
            tt.toolbox = document.getElementById('toolbox')
            tt.scrollbars = true
            tt.css = true
            tt.zoom = {
                controls: true,
                wheel: true,
                startScale: 1.0,
                maxScale: 4,
                minScale: .25,
                scaleSpeed: 1.1
            }
            blocklyDiv = document.getElementById('blocklyDiv');
            blocklyArea = document.getElementById('blocklyArea');


            workspace = Blockly.inject(blocklyDiv, tt);



            console.log("Blockly injected")
            console.log(workspace)


            // Compute the absolute coordinates and dimensions of blocklyArea.
            var element = blocklyArea;
            var x = 0;
            var y = 0;
            do {
                x += element.offsetLeft;
                y += element.offsetTop;
                element = element.offsetParent;
            } while (element);
            // Position blocklyDiv over blocklyArea.
            blocklyDiv.style.left = x + 'px';
            blocklyDiv.style.top = y + 'px';
            blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
            blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
            Blockly.svgResize(workspace);





            var opts = {
                angle: 0.15, // The span of the gauge arc
                lineWidth: 0.44, // The line thickness
                radiusScale: 1, // Relative radius
                pointer: {
                    length: 0.6, // // Relative to gauge radius
                    strokeWidth: 0.035, // The thickness
                    color: '#000000' // Fill color
                },
                staticLabels: {
                    font: "10px sans-serif", // Specifies font
                    labels: [-0.5, -0.4, -0.3, -0.2, -0.1, 0, 0.1, 0.2, 0.2, 0.4,
                        0.5
                    ], // Print labels at these values
                    color: "#000000", // Optional: Label text color
                    fractionDigits: 0 // Optional: Numerical precision. 0=round off.
                },
                renderTicks: {
                    divisions: 5,
                    divWidth: 1.1,
                    divLength: 0.7,
                    divColor: '#333333',
                    subDivisions: 3,
                    subLength: 0.5,
                    subWidth: 0.6,
                    subColor: '#666666'
                },
                limitMax: false, // If false, max value increases automatically if value > maxValue
                limitMin: false, // If true, the min value of the gauge will be fixed
                colorStart: '#6FADCF', // Colors
                colorStop: '#8FC0DA', // just experiment with them
                strokeColor: '#E0E0E0', // to see which ones work best for you
                generateGradient: true,
                highDpiSupport: true, // High resolution support

            };





            $(".GaugeMeter").gaugeMeter();



            wpointname = document.getElementById('waypointname');
            createJoystick();
            loadMap()
            $('#waypointTable').bootstrapTable({
                onCheck: function (row, $element) {
                    //alert(JSON.stringify(row));
                    gwaypoint_name = row.name
                    var getwaypointparam = new ROSLIB.ServiceRequest({
                        name: row.name,
                        mapname: gmap_name
                    });



                    getPoseWaypointName.callService(getwaypointparam, function (result) {
                        g_pose = result
                        console.log(result);
                    })



                }
            });


            $('#mapTable').bootstrapTable({
                onCheck: function (row, $element) {
                    //alert(JSON.stringify(row));
                    isMapChoosen = true
                    gmap_name = row.name
                    var getwaypointparam = new ROSLIB.ServiceRequest({
                        mapname: row.name
                    });


                    getWaypointName.callService(getwaypointparam, function (result) {
                        console.log(result);
                        var dataSet = []
                        while (g_waypoints.length > 0) {
                            g_waypoints.pop();
                        }
                        //g_waypoints.push(['none', 'NONE'])

                        if (result.length == 0) {
                            isWaypointAvaliable = false
                        } else {
                            isWaypointAvaliable = true
                        }
                        result.waypointname.forEach(fn => {
                            var item = {
                                name: fn
                            }
                            dataSet.push(item)
                            g_waypoints.push(item)
                            console.log(fn)

                        });


                        console.log(dataSet)

                        $('#waypointTable').bootstrapTable({
                            data: dataSet
                        })

                        // $('#mapTable').bootstrapTable("destroy");
                        $('#waypointTable').bootstrapTable('load', dataSet)
                    })

                    var getwaypointparam = new ROSLIB.ServiceRequest({
                        name: row.name
                    });



                    getWayPoints.callService(getwaypointparam, function (result) {
                        console.log(result);
                    })
                }
            });




            /*      const checkbox = document.getElementById('switch_slam')
              console.log("+++++++++++++++++")

              console.log(checkbox)


              checkbox.addEventListener('change', (event) => {
                  console.log("checked !!!!!!")
                  if (event.target.checked) {
                      startSLAMsrv.callService(onSlam, function (result) {
                          console.log(result);
                      })
                      alert('checked');
                  } else {
                      startSLAMsrv.callService(offSlam, function (result) {
                          console.log(result);
                      })
                      alert('not checked');
                  }
              })*/




            /*mapTable.on('select', function (e, dt, type, indexes) {
                var count = table.rows({
                    selected: true
                }).count();
                console.log("==============================>")
                console.log(count)

                // do something with the number of selected rows
            });*/

            /* var dataSet = [['aaaaa'],['bbbb'],['cccccc']]
             console.log(dataSet)
             var mTable = $('#mapTable').DataTable({
                 aaData: dataSet,
                 columns: [{
                         title: "Name"
                     }
                 ]
             });*/

            //console.log(mTable)

            // Our labels along the x-axis



            var ctx = document.getElementById("imuChart");
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: time,
                    datasets: [{
                        data: imuData
                    }, {
                        data: angularVelocity
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                min: -0.01,
                                max: 0.01,
                                stepSize: 0.0005,
                            }
                        }]
                    }
                }

            });

            Blockly.Blocks['sleep_type'] = {
                init: function () {
                    this.appendDummyInput()
                        .appendField("Sleep for");
                    this.appendValueInput("NAME")
                        .setCheck("Number");
                    this.appendDummyInput()
                        .appendField("sec");
                    this.setInputsInline(true);
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("");
                    this.setHelpUrl("");
                }
            };

            Blockly.Python['sleep_type'] = function (block) {
                var value_name = Blockly.Python.valueToCode(block, 'NAME', Blockly.Python
                    .ORDER_ATOMIC);
                // TODO: Assemble JavaScript into code variable.
                var code = 'time.sleep(' + value_name + ')\n';
                return code;
            };


            Blockly.Blocks['agv_init'] = {
                init: function () {
                    this.appendDummyInput()
                        .appendField("AGV navigation init");
                    this.setInputsInline(true);
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("");
                    this.setHelpUrl("");
                }
            };

            Blockly.Python['agv_init'] = function (block) {
                // TODO: Assemble JavaScript into code variable.
                var code = "import rospy\n"
                code = code + "import actionlib\n"
                code = code + "from move_base_msgs.msg import MoveBaseAction, MoveBaseGoal\n"
                code = code + "import json\n"
                code = code + "from tinydb import TinyDB, Query\n"
                code = code + "from rospy_message_converter import json_message_converter\n"
                code = code + "import agv\n"
                code = code + "import time\n"
                code = code + "waypoint_db = TinyDB('/home/pi/db.json')\n"
                code = code + "rospy.init_node('patrol')\n"
                code = code + "client = actionlib.SimpleActionClient('move_base', MoveBaseAction)\n"
                code = code + "client.wait_for_server()\n"





                return code;
            };





            Blockly.Blocks['move_to'] = {
                init: function () {
                    this.appendDummyInput()
                        .appendField("Move to ");
                    this.appendValueInput("map_name")
                        .setCheck("String")
                        .appendField("map");
                    this.appendValueInput("waypoint")
                        .setCheck("String")
                        .appendField("waypoint");
                    this.setInputsInline(true);
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("");
                    this.setHelpUrl("");
                }
            };


            Blockly.Python['move_to'] = function (block) {
                var value_map_name = Blockly.Python.valueToCode(block, 'map_name', Blockly.Python
                    .ORDER_ATOMIC);
                var value_waypoint = Blockly.Python.valueToCode(block, 'waypoint', Blockly.Python
                    .ORDER_ATOMIC);
                // TODO: Assemble Python into code variable.
                var code = 'goal = agv.goal_pose(waypoint_db, ' + value_map_name + ' , ' +
                    value_waypoint + ')\n';
                var code = code + "client.send_goal(goal)\n"
                var code = code + "client.wait_for_result()\n"
                return code;
            };


            Blockly.Blocks['move_to_preset'] = {
                init: function () {
                    this.appendDummyInput()
                        .appendField("Move to ");

                    this.appendDummyInput()
                        .appendField(gmap_name + " ");


                    this.appendDummyInput()
                        .appendField('waypoint')
                        .appendField(new Blockly.FieldDropdown(
                            this.generateOptions), 'WAYPOINT');
                    this.setInputsInline(true);
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("");
                    this.setHelpUrl("");
                },

                generateOptions: function () {
                    var options = [];

                    for (var i = 0; i < g_waypoints.length; i++) {

                        options.push([g_waypoints[i].name, g_waypoints[i].name]);

                    }
                    return options;
                }
            };


            Blockly.Python['move_to_preset'] = function (block) {

                /*var value_waypoint = Blockly.Python.valueToCode(block, 'waypoint', Blockly.Python
                    .ORDER_ATOMIC);*/


                var value_waypoint = block.getFieldValue('WAYPOINT');
                // TODO: Assemble Python into code variable.
                var code = 'goal = agv.goal_pose(waypoint_db, "' + gmap_name + '" , "' +
                    value_waypoint + '")\n';
                var code = code + "client.send_goal(goal)\n"
                var code = code + "client.wait_for_result()\n"
                return code;
            };



            Blockly.Blocks['rospy_loop'] = {
                init: function () {
                    this.appendDummyInput()
                        .appendField("ROS FOEVER LOOP");
                    this.appendStatementInput("DO")
                        .setCheck(null)
                        .setAlign(Blockly.ALIGN_RIGHT);
                    this.setPreviousStatement(true, null);
                    this.setNextStatement(true, null);
                    this.setColour(230);
                    this.setTooltip("");
                    this.setHelpUrl("");
                }
            };

            Blockly.Python['rospy_loop'] = function (block) {
                var statements_name = Blockly.Python.statementToCode(block, 'NAME');
                // TODO: Assemble Python into code variable.
                var branch = Blockly.Python.statementToCode(block, 'DO');
                branch = Blockly.Python.addLoopTrap(branch, block) || Blockly.Python.PASS;

                var code = 'while not rospy.is_shutdown():\n' + branch;
                return code;
            };





        })
        //-------------------- End Doc Ready --------------------------





        ip = location.host;
        ip = ip.substring(0, ip.indexOf(':'));
        console.log(ip)


        function saveBlockly() {
            var xml = Blockly.Xml.workspaceToDom(workspace);
            var xml_text = Blockly.Xml.domToText(xml);

            var inputVal = document.getElementById("file_name").value;

            var xhr = new XMLHttpRequest();
            var url = "http://" + ip + ":5000/uploadXML";
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    console.log("Upload sucessful")
                    $('#cancel-blockly-btn').click();
                }
            };
            var data = JSON.stringify({
                filename: inputVal,
                data: xml_text
            })
            xhr.send(data);

        }


        function runBlockly(t) {
            /*var code = Blockly.Python.workspaceToCode(workspace);
                console.log(code)*/

            if (t.value == "run") {

                var code = Blockly.Python.workspaceToCode(workspace);
                console.log(code)

                var xhr = new XMLHttpRequest();
                var url = "http://" + ip + ":5000/run";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {

                    }
                };
                var data = JSON.stringify({
                    data: code
                })
                xhr.send(data);

                t.innerHTML = "STOP";
                t.value = "stop"

            } else {

                var xhr = new XMLHttpRequest();
                var url = "http://" + ip + ":5000/stop";
                xhr.open("POST", url, true);
                xhr.setRequestHeader("Content-Type", "application/json");
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {}
                };
                var data = JSON.stringify({
                    data: ""
                })
                xhr.send(data);

                t.innerHTML = "RUN";
                t.value = "run"

            }


        }




        var baseZoomX = 1;
        var baseZoomY = 1;
        // Connect to ROS.
        var ros = new ROSLIB.Ros({
            //url: 'ws://192.168.88.248:9090'
            url: "ws://" + ip + ":9090"

        });










        // Scale the canvas to fit to the map

        /*var aaa1 = new ROS2D.ArrowShape({
            rootObject: viewer.scene
        })*/

        /*gridClient.on('change', function () {
            viewer.scaleToDimensions(gridClient.currentGrid.width, gridClient.currentGrid.height);
            viewer.shift(gridClient.currentGrid.pose.position.x, gridClient.currentGrid.pose.position.y);
            viewer.scene.addChild(aaa1)
            console.log("zoom ===== ")
            console.log(viewer.scene.scaleX)

            //viewer.scene.scaleX*=6
            //viewer.scene.scaleY*=6
            //viewer.scene.x+=200
            //viewer.scene.y-=300
            //zoomView.startZoom(gridClient.currentGrid.width/2, gridClient.currentGrid.height/2)
            //zoomView.zoom(3)


        });*/


        ros.on('connection', function () {
            console.log("Connected!!!!!")


            console.log(colWidth / 12 * 8)
            // Create the main viewer.
            viewer3d = new ROS3D.Viewer({
                divID: 'map3d',
                width: colWidth / 12 * 8,
                height: colWidth / 12 * 8 * 3 / 4,
                antialias: true
            });

            viewer3d.resize(document.getElementById("map3d").offsetWidth * 0.96, document.getElementById(
                "map3d").offsetWidth * 3 / 4 * 0.96)

            var tfClient = new ROSLIB.TFClient({
                ros: ros,
                angularThres: 0.01,
                transThres: 0.01,
                rate: 10.0,
                fixedFrame: 'map',
                serverName: 'tf2_web_republisher'
            });


            var laserScan = new ROS3D.LaserScan({
                    ros: ros,
                    topic: 'scan',
                    tfClient: tfClient,
                    rootObject: viewer3d.scene,
                    material: {
                        color: 0x880000,
                        size: 0.1
                    }
                }

            )

            var sn = null


            var pathDisplay = new ROS3D.Path({
                ros: ros,
                tfClient: tfClient,
                rootObject: viewer3d.scene,
                topic: '/move_base/GlobalPlanner/plan'

            })

            viewer3d.addObject(pathDisplay);


            //var orCtl = new ROS3D.OrbitControls(viewer3d.scene, viewer3d.camera)
            //viewer3d.addObject(orCtl);

            var poseR = new ROS3D.Pose({
                ros: ros,
                tfClient: tfClient,
                rootObject: viewer3d.scene,
                topic: 'robot_pose'

            })


            var urdfClient = new ROS3D.UrdfClient({
                ros: ros,
                tfClient: tfClient,
                rootObject: viewer3d.scene
            });

            var gridClient3d = new ROS3D.OccupancyGridClient({
                ros: ros,
                continuous: true,
                rootObject: viewer3d.scene
            });

            /*             var cosmap3d = new ROS3D.OccupancyGridClient({
                            ros: ros,
                            topic: "/move_base/global_costmap/costmap",
                            continuous: true,
                            opacity: 0.5,
                            offsetPose: new ROSLIB.Pose({
                                position: {
                                    x: 0,
                                    y: 0,
                                    z: -1
                                }
                            }),
                            rootObject: viewer3d.scene
                        }) */



            var tfClientM = new ROSLIB.TFClient({
                ros: ros,
                angularThres: 0.01,
                transThres: 0.01,
                rate: 10.0,
                fixedFrame: '/map'
            });





            var imClient = new ROS3D.InteractiveMarkerClient({
                ros: ros,
                tfClient: tfClientM,
                topic: '/simple_marker',
                camera: viewer3d.camera,
                rootObject: viewer3d.selectableObjects
            });


            var robotPosition = new ROS3D.MarkerClient({
                ros: ros,
                tfClient: tfClientM,
                topic: '/visualization_marker',
                camera: viewer3d.camera,
                rootObject: viewer3d.selectableObjects,
                lifetime: 10

            })


            var robotWaypoints = new ROS3D.MarkerArrayClient({
                ros: ros,
                tfClient: tfClientM,
                topic: '/visualization_marker_array',
                rootObject: viewer3d.selectableObjects,

            })

            var robotWaypoints_text = new ROS3D.MarkerArrayClient({
                ros: ros,
                tfClient: tfClientM,
                topic: '/visualization_marker_array_text',
                rootObject: viewer3d.selectableObjects,

            })


            twist = new ROSLIB.Message({
                linear: {
                    x: 0,
                    y: 0,
                    z: 0
                },
                angular: {
                    x: 0,
                    y: 0,
                    z: 0
                }
            });
            // Init topic object
            cmdVel = new ROSLIB.Topic({
                ros: ros,
                name: '/cmd_vel',
                messageType: 'geometry_msgs/Twist'
            });
            // Register publisher within ROS system
            cmdVel.advertise();

 




            move_base_status_listener = new ROSLIB.Topic({
                ros: ros,
                name: '/move_base/status',
                messageType: 'actionlib_msgs/GoalStatusArray'

            });

            var nav_statusElement = document.getElementById('nav_status');
            move_base_status_listener.subscribe(function (message) {
                if(message.status_list.length == 1){
                console.log(message.status_list[0].status)

                if (message.status_list[0].status == 3) {
                     if (nav_statusElement) {
                         nav_statusElement.innerHTML = 'Goal react';
                     }
                 } else if (message.status_list[0].status == 1) {
                     if (nav_statusElement) {
                         nav_statusElement.innerHTML = 'Driving';
                     }
                 }
                }
            });


            var onresize = function (e) {
                // Compute the absolute coordinates and dimensions of blocklyArea.
                console.log("resizing")
                console.log(document.getElementById("map3d").offsetWidth)
                viewer3d.resize(document.getElementById("map3d").offsetWidth * 0.96, document
                    .getElementById(
                        "map3d").offsetWidth * 0.96 * 3 / 4)

                var element = blocklyArea;
                var x = 0;
                var y = 0;
                do {
                    x += element.offsetLeft;
                    y += element.offsetTop;
                    element = element.offsetParent;
                } while (element);
                // Position blocklyDiv over blocklyArea.
                blocklyDiv.style.left = x + 'px';
                blocklyDiv.style.top = y + 'px';
                blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
                blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
                Blockly.svgResize(workspace);
            };
            window.addEventListener('resize', onresize, false);
            //onresize();


        });




        var actionClient = new ROSLIB.ActionClient({
            ros: ros,
            actionName: 'move_base_msgs/MoveBaseAction',
            serverName: '/move_base'
        });



        function sendGoal() {
            // create a goal


            console.log("send goal")
            //console.log(pose)
            console.log(g_pose)


            var goal = new ROSLIB.Goal({
                actionClient: actionClient,
                goalMessage: {
                    target_pose: {
                        header: {
                            frame_id: 'map'
                        },
                        pose: g_pose.pose
                    }
                }
            });
            goal.send();

            goal.on('feedback', function (feedback) {
                // console.log('Feedback: ' + feedback);
            });

            goal.on('result', function (result) {
                // console.log('Final Result: ' + result);
            });


        }


        var getPoseSrv = new ROSLIB.Service({
            ros: ros,
            name: '/get_pose',
            serviceType: 'agv_interface/getpost'
        })




        var startSLAMsrv = new ROSLIB.Service({
            ros: ros,
            name: '/start_slam',
            serviceType: 'agv_interface/slamsrv'
        });


        var deleteMap = new ROSLIB.Service({
            ros: ros,
            name: '/delete_map',
            serviceType: 'agv_interface/deletemap'

        })

        var deleteWaypoit = new ROSLIB.Service({
            ros: ros,
            name: '/delete_waypoint',
            serviceType: 'agv_interface/deletewaypoint'

        })

        var onSlam = new ROSLIB.ServiceRequest({
            onezero: 1,
            map_file: "map_office"
        });



        var offSlam = new ROSLIB.ServiceRequest({
            onezero: 0,
            map_file: "map_office"
        });



        var startNavSrv = new ROSLIB.Service({
            ros: ros,
            name: '/start_navigation',
            serviceType: 'agv_interface/navigatesrv'
        });

        var onNav = new ROSLIB.ServiceRequest({
            onezero: 1,
            map_file: "map_office"
        });

        var offNav = new ROSLIB.ServiceRequest({
            onezero: 0,
            map_file: "map_office"
        });







        var onMarker = new ROSLIB.ServiceRequest({
            onezero: 1
        });

        var offMarker = new ROSLIB.ServiceRequest({
            onezero: 0
        });

        var showPoseMarker = new ROSLIB.Service({
            ros: ros,
            name: '/poseestimate_markers_service',
            serviceType: 'agv_interface/poseestimate'
        });


        var showNavMarker = new ROSLIB.Service({
            ros: ros,
            name: '/waypoint_markers_service',
            serviceType: 'agv_interface/navigatesrv'
        });

        var setPose = new ROSLIB.Service({
            ros: ros,
            name: '/set_pose',
            serviceType: 'agv_interface/poseestimate'
        });

        var getMap = new ROSLIB.Service({
            ros: ros,
            name: '/get_map',
            serviceType: 'agv_interface/maps'
        });

        var getWaypointList = new ROSLIB.Service({
            ros: ros,
            name: '/list_waypoint',
            serviceType: 'agv_interface/maps'
        });

        var getWayPoints = new ROSLIB.Service({
            ros: ros,
            name: '/get_waypoint',
            serviceType: 'agv_interface/waypointsarray'
        });

        var getWaypointName = new ROSLIB.Service({
            ros: ros,
            name: '/get_waypoint_name',
            serviceType: 'agv_interface/waypointname'
        });

        var getPoseWaypointName = new ROSLIB.Service({
            ros: ros,
            name: '/get_a_waypoint',
            serviceType: 'agv_interface/awaypoint'
        });





        var saveMapSrv = new ROSLIB.Service({
            ros: ros,
            name: '/save_map',
            serviceType: 'agv_interface/savemaps'
        })




        function startSLAM() {
            if (document.getElementById('switch_slam').checked) {

                startSLAMsrv.callService(onSlam, function (result) {
                    console.log(result);
                })
            } else {
                startSLAMsrv.callService(offSlam, function (result) {
                    console.log(result);
                })
            }


            console.log("Click Click")
        }


        $(function () {
            $('#switch_nav').change(function () {
                var check_nav = $(this).prop('checked')
                mapname = $('#mapTable').bootstrapTable('getSelections')[0].name

                if (check_nav == true) {

                    var onNav_ = new ROSLIB.ServiceRequest({
                        onezero: 1,
                        map_file: mapname
                    });

                    console.log(onNav_)

                    startNavSrv.callService(onNav_, function (result) {
                        console.log(result);
                    })
                    document.getElementById("switch_slam").disabled = true
                    document.getElementById("save_map_btn").disabled = true


                } else {

                    var offNav_ = new ROSLIB.ServiceRequest({
                        onezero: 0,
                        map_file: mapname
                    });


                    console.log(offNav_)

                    startNavSrv.callService(offNav_, function (result) {
                        console.log(result);
                    })

                    document.getElementById("switch_slam").disabled = false
                    document.getElementById("save_map_btn").disabled = false
                }
                console.log(check_nav)
            })
        })


        $(function () {
            $('#switch_slam').change(function () {
                var check_nav = $(this).prop('checked')
                if (check_nav == true) {

                    startSLAMsrv.callService(onSlam, function (result) {
                        console.log(result);
                    })

                    document.getElementById("switch_nav").disabled = true


                } else {
                    startSLAMsrv.callService(offSlam, function (result) {
                        console.log(result);
                    })

                    document.getElementById("switch_nav").disabled = false
                }
                console.log(check_nav)
            })
        })


        $(function () {
            $('#show_pose_marker').change(function () {
                var check_nav = $(this).prop('checked')
                if (check_nav == true) {

                    showPoseMarker.callService(onMarker, function (result) {
                        console.log(result);
                    })
                } else {
                    showPoseMarker.callService(offMarker, function (result) {
                        console.log(result);
                    })
                }
                console.log(check_nav)
            })
        })


        $(function () {
            $('#show_nav_marker').change(function () {
                var check_nav = $(this).prop('checked')
                if (check_nav == true) {

                    showNavMarker.callService(onMarker, function (result) {
                        console.log(result);
                    })
                } else {
                    showNavMarker.callService(offMarker, function (result) {
                        console.log(result);
                    })
                }
                console.log(check_nav)
            })
        })





        function deleteAmap() {
            var delMapParam = new ROSLIB.ServiceRequest({
                mapfile: gmap_name
            });
            deleteMap.callService(delMapParam, function (result) {
                console.log(result)
                loadMap()
            })
        }


        function deleteAwaypoint() {
            var delWaypointParam = new ROSLIB.ServiceRequest({
                mapfile: gmap_name,
                waypoint: gwaypoint_name
            });

            deleteWaypoit.callService(delWaypointParam, function (result) {
                var getwaypointparam = new ROSLIB.ServiceRequest({
                    mapname: gmap_name
                });
                getWaypointName.callService(getwaypointparam, function (result) {
                    console.log(result);
                    var dataSet = []
                    while (g_waypoints.length > 0) {
                        g_waypoints.pop();
                    }
                    //g_waypoints.push(['none', 'NONE'])

                    if (result.length == 0) {
                        isWaypointAvaliable = false
                    } else {
                        isWaypointAvaliable = true
                    }
                    result.waypointname.forEach(fn => {
                        var item = {
                            name: fn
                        }
                        dataSet.push(item)
                        g_waypoints.push(item)
                        console.log(fn)

                    });


                    console.log(dataSet)

                    $('#waypointTable').bootstrapTable({
                        data: dataSet
                    })

                    // $('#mapTable').bootstrapTable("destroy");
                    $('#waypointTable').bootstrapTable('load', dataSet)
                })


                var getwaypointparam = new ROSLIB.ServiceRequest({
                    name: gmap_name
                });



                getWayPoints.callService(getwaypointparam, function (result) {
                    console.log(result);
                })

            })
        }


        function loadMap() {
            getMap.callService(onMarker, function (result) {
                console.log("Done");
                console.log(result);
                var dataSet = []
                result.map_file.forEach(fn => {
                    var item = {
                        name: fn
                    }
                    dataSet.push(item)
                    console.log(fn)

                });


                console.log(dataSet)

                $('#mapTable').bootstrapTable({
                    data: dataSet
                })

                // $('#mapTable').bootstrapTable("destroy");
                $('#mapTable').bootstrapTable('load', dataSet)



            })


            /*getWaypointList.callService(onMarker, function (result) {
                console.log("Done");
                console.log(result);
                var dataSet = []
                result.map_file.forEach(fn => {
                    var item = {
                        name: fn
                    }
                    dataSet.push(item)
                    console.log(fn)

                });


                console.log(dataSet)

                $('#waypointTable').bootstrapTable({
                    data: dataSet
                })

                // $('#mapTable').bootstrapTable("destroy");
                $('#waypointTable').bootstrapTable('load', dataSet)



            })*/



        }








        $(function () {
            $('#exampleModal').on('show.bs.modal', function () {
                // do something…
                console.log("Modal loaded")
                var table = document.getElementById('tableContents');
                var tableContents = ''
                dataFiles.forEach(fn => {
                    console.log(fn)
                    tableContents = tableContents + '<tr class="clickableRow"><td>' + fn +
                        '</td></tr>';

                });
                console.log(tableContents)
                table.innerHTML = tableContents;

            })
        })






        /*$(function () {
            $('#mapTable').on('click', 'tbody tr', function (event) {
                $(this).addClass('highlight').siblings().removeClass('highlight');
                //var myTable = $('#mapTable').DataTable();
                //var numberOfSelections = $('#mapTable').bootstrapTable('getSelections').row; 
                console.log(myTable)
            });
        })*/




        function setPoseCall() {
            setPose.callService(onMarker, function (result) {
                console.log(result);
            })
        }

        function setNavCall() {
            setPose.callService(onMarker, function (result) {
                console.log(result);
            })
        }

        function getPose() {
            console.log("get pose")
            console.log(selectedMapName)
            console.log(seqWayPoint)
            var mapname = $('#mapTable').bootstrapTable('getSelections')[0].name
            var poseReq = new ROSLIB.ServiceRequest({
                name: wpointname.value,
                seq: seqWayPoint,
                mapname: mapname
            });
            console.log(poseReq)
            console.log(getPoseSrv)
            getPoseSrv.callService(poseReq, function (result) {
                console.log(result);
                var getwaypointparam = new ROSLIB.ServiceRequest({
                    mapname: mapname
                });
                getWaypointName.callService(getwaypointparam, function (result) {
                    console.log(result);
                    var dataSet = []
                    while (g_waypoints.length > 0) {
                        g_waypoints.pop();
                    }
                    //g_waypoints.push(['none', 'NONE'])

                    if (result.length == 0) {
                        isWaypointAvaliable = false
                    } else {
                        isWaypointAvaliable = true
                    }
                    result.waypointname.forEach(fn => {
                        var item = {
                            name: fn
                        }
                        dataSet.push(item)
                        g_waypoints.push(item)
                        console.log(fn)

                    });


                    console.log(dataSet)

                    $('#waypointTable').bootstrapTable({
                        data: dataSet
                    })

                    // $('#mapTable').bootstrapTable("destroy");
                    $('#waypointTable').bootstrapTable('load', dataSet)
                })

                var getwaypointparam = new ROSLIB.ServiceRequest({
                    name: mapname
                });



                getWayPoints.callService(getwaypointparam, function (result) {
                    console.log(result);
                })
            })
        }

        function setWaypointBtnActivation() {
            if (!document.getElementById('waypointname').value.length) {
                document.getElementById("setwaypointbtn").disabled = true;
            } else {
                document.getElementById("setwaypointbtn").disabled = false;

            }
        }


        function saveMap() {
            var inputVal = document.getElementById("map_name").value;
            var mapName_ = new ROSLIB.ServiceRequest({
                mapfile: inputVal
            });

            console.log(mapName_)
            console.log(saveMapSrv)

            saveMapSrv.callService(mapName_, function (result) {
                console.log(result);
            })
            console.log(inputVal)
        }


        function generateTableHead(table, data) {
            let thead = table.createTHead();
            let row = thead.insertRow();
            for (let key of data) {
                let th = document.createElement("th");
                let text = document.createTextNode(key);
                th.appendChild(text);
                row.appendChild(th);
            }
        }

        function generateTable(table, data) {
            $("#filelist").empty();
            var tbody = document.createElement('tbody');
            table.appendChild(tbody);
            tbody.id = "filetable";
            tbody.setAttribute('id', "filetable");
            for (let element of data) {
                let row = tbody.insertRow();
                for (key in element) {
                    let cell = row.insertCell();
                    let text = document.createTextNode(element[key]);
                    cell.appendChild(text);

                }
            }
        }

        var selected_file = ""

        function getFile() {
            let mountains = [];
            // 1. Create a new XMLHttpRequest object
            let xhr = new XMLHttpRequest();

            // 2. Configure it: GET-request for the URL /article/.../load
            var url = "http://" + ip + ":5000/getXML";
            xhr.open('GET', url);
            xhr.responseType = 'json';

            // 3. Send the request over the network
            xhr.send();

            // 4. This will be called after the response is received
            xhr.onload = function () {
                if (xhr.status != 200) { // analyze HTTP status of the response
                    console.log(`Error ${xhr.status}: ${xhr.statusText}`); // e.g. 404: Not Found
                } else { // show the result
                    console.log(xhr.response.files); // response is the server
                    mountains = xhr.response.files
                    let table = document.getElementById("filelist");
                    generateTable(table, mountains);

                    $("#filelist tr").click(function () {

                        selected_file = $(this).find('td:first').html();

                        console.log(selected_file);
                        document.getElementById("load-blockly-btn").disabled = false;

                    })
                }
            };






        }

        function getEditMap(){
            function getFile() {
                let mountains = [];
                let xhr = new XMLHttpRequest();
                var url = "http://" + ip + ":5000/getEditMap";
                xhr.open('GET', url);
                xhr.responseType = 'json';
                xhr.send();
                xhr.onload = function () {
                    if (xhr.status != 200) { // analyze HTTP status of the response
                        console.log(`Error ${xhr.status}: ${xhr.statusText}`); // e.g. 404: Not Found
                    } else { // show the result
                        console.log(xhr.response); // response is the server
                    }
                };
            }
        }

        function loadBlockly() {
            //let table = document.getElementById("file-list");
            var xhr = new XMLHttpRequest();
            var url = "http://" + ip + ":5000/getXMLdata";
            xhr.open("POST", url, true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.responseType = 'json';



            xhr.onload = function () {
                if (xhr.status != 200) { // analyze HTTP status of the response
                    console.log(`Error ${xhr.status}: ${xhr.statusText}`); // e.g. 404: Not Found
                } else { // show the result
                    console.log(xhr.response.content); // response is the server
                    workspace.clear()
                    var xml = Blockly.Xml.textToDom(xhr.response.content);
                    Blockly.Xml.domToWorkspace(xml, workspace);

                }
            };

            var data = JSON.stringify({
                filename: selected_file
            })
            xhr.send(data);

            console.log(selected_file)




        }




        $(document).on('shown.bs.tab', 'a[data-toggle="tab"]', function (e) {
            console.log(e.target.id.localeCompare("Pogramming")) // activated tab



            if (e.target.id.localeCompare("Pogramming") == 1) {
                console.log("Fa prog")
                var element = blocklyArea;
                var x = 0;
                var y = 0;
                do {
                    x += element.offsetLeft;
                    y += element.offsetTop;
                    element = element.offsetParent;
                } while (element);
                // Position blocklyDiv over blocklyArea.
                blocklyDiv.style.left = x + 'px';
                blocklyDiv.style.top = y + 'px';
                blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
                blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
                Blockly.svgResize(workspace);
            } else {
                console.log("Fa bav")
                console.log(document.getElementById("map3d").offsetWidth)
                viewer3d.resize(document.getElementById("map3d").offsetWidth * 0.96, document.getElementById(
                    "map3d").offsetWidth * 3 / 4 * 0.96)
            }
        })
    </script>
</head>



<body>
    <xml id="toolbox" style="display: none">
        <category name="Logic" colour="%{BKY_LOGIC_HUE}">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
            <block type="logic_boolean"></block>
            <block type="logic_null"></block>
            <block type="logic_ternary"></block>
        </category>
        <category name="Loop" colour="%{BKY_LOOPS_HUE}">
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_whileUntil"></block>
            <block type="controls_for">
                <value name="FROM">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="TO">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
                <value name="BY">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_forEach"></block>
            <block type="controls_flow_statements"></block>
        </category>
        <category name="Math" colour="%{BKY_MATH_HUE}">
            <block type="math_number">
                <field name="NUM">123</field>
            </block>
            <block type="math_arithmetic">
                <value name="A">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="B">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_single">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">9</field>
                    </shadow>
                </value>
            </block>
            <block type="math_trig">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">45</field>
                    </shadow>
                </value>
            </block>
            <block type="math_constant"></block>
            <block type="math_number_property">
                <value name="NUMBER_TO_CHECK">
                    <shadow type="math_number">
                        <field name="NUM">0</field>
                    </shadow>
                </value>
            </block>
            <block type="math_round">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">3.1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_on_list"></block>
            <block type="math_modulo">
                <value name="DIVIDEND">
                    <shadow type="math_number">
                        <field name="NUM">64</field>
                    </shadow>
                </value>
                <value name="DIVISOR">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
            </block>
            <block type="math_constrain">
                <value name="VALUE">
                    <shadow type="math_number">
                        <field name="NUM">50</field>
                    </shadow>
                </value>
                <value name="LOW">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="HIGH">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
            </block>
            <block type="math_random_int">
                <value name="FROM">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="TO">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
            </block>
            <block type="math_random_float"></block>
            <block type="math_atan2">
                <value name="X">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="Y">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
        </category>
        <category name="Text" colour="%{BKY_TEXTS_HUE}">
            <block type="text"></block>
            <block type="text_join"></block>
            <block type="text_append">
                <value name="TEXT">
                    <shadow type="text"></shadow>
                </value>
            </block>
            <block type="text_length">
                <value name="VALUE">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_isEmpty">
                <value name="VALUE">
                    <shadow type="text">
                        <field name="TEXT"></field>
                    </shadow>
                </value>
            </block>
            <block type="text_indexOf">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">{textVariable}</field>
                    </block>
                </value>
                <value name="FIND">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_charAt">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">{textVariable}</field>
                    </block>
                </value>
            </block>
            <block type="text_getSubstring">
                <value name="STRING">
                    <block type="variables_get">
                        <field name="VAR">{textVariable}</field>
                    </block>
                </value>
            </block>
            <block type="text_changeCase">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_trim">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_print">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_prompt_ext">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
        </category>
        <category name="List" colour="%{BKY_LISTS_HUE}">
            <block type="lists_create_with">
                <mutation items="0"></mutation>
            </block>
            <block type="lists_create_with"></block>
            <block type="lists_repeat">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">5</field>
                    </shadow>
                </value>
            </block>
            <block type="lists_length"></block>
            <block type="lists_isEmpty"></block>
            <block type="lists_indexOf">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">{listVariable}</field>
                    </block>
                </value>
            </block>
            <block type="lists_getIndex">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">{listVariable}</field>
                    </block>
                </value>
            </block>
            <block type="lists_setIndex">
                <value name="LIST">
                    <block type="variables_get">
                        <field name="VAR">{listVariable}</field>
                    </block>
                </value>
            </block>
            <block type="lists_getSublist">
                <value name="LIST">
                    <block type="variables_get">
                        <field name="VAR">{listVariable}</field>
                    </block>
                </value>
            </block>
            <block type="lists_split">
                <value name="DELIM">
                    <shadow type="text">
                        <field name="TEXT">,</field>
                    </shadow>
                </value>
            </block>
            <block type="lists_sort"></block>
        </category>

        <sep></sep>
        <category name="Variables" colour="%{BKY_VARIABLES_HUE}" custom="VARIABLE"></category>
        <category name="Functions" colour="%{BKY_PROCEDURES_HUE}" custom="PROCEDURE"></category>
        <category name="AGV Control" colour="%{BKY_LISTS_HUE}">
            <block type="agv_init"></block>
            <block type="move_to"></block>
            <!--<block type="move_to_preset"></block>-->
            <block type="rospy_loop"></block>
            <block type="sleep_type"></block>
        </category>
    </xml>


    <div class="container-fluid">
        <h2>Navigation Tabs</h2>
        <ul class="nav nav-tabs">

            <li class="nav-item">
                <a href="#2a" id="Navigation" class="nav-link active" data-toggle="tab">Navigation</a>
            </li>
            <li class="nav-item">
                <a href="#1a" id="Programming" class="nav-link" data-toggle="tab">Programming</a>
            </li>
        </ul>

        <div class="tab-content clearfix">

            <div class="tab-pane" id="1a">


                <div class="row">
                    <div id="blocklyArea" class="col-8" style="height: 100vh; background-color: cyan;">
                        <div id="blocklyDiv" style="width: 100vw; height: 100vh; background-color: blue;">
                        </div>
                    </div>

                    <div class="col-4" style="background-color: red;">
                        <div class="row">

                            <button type="button" class="btn btn-info btn-lg" value="run" onclick="runBlockly(this)"
                                id="run_blockly">RUN</button>

                        </div>
                        <div class="row">

                            <button type="button" class="btn btn-info btn-lg" data-toggle="modal"
                                data-target="#saveBlockyModal" id="save_blockly">Save</button>
                        </div>

                        <div class="row">

                            <button type="button" class="btn btn-info btn-lg" data-toggle="modal"
                                data-target="#loadBlockyModal" onclick="getFile()" id="load_blockly">Load</button>
                        </div>
                    </div>
                </div>


            </div>

            <div class="tab-pane active" id="2a">
                <div class="row mx-2">
                    <div class="col-2">
                        <div class="row">
                            SLAM: <input type="checkbox" id="switch_slam" data-toggle="toggle" />
                            <button type="button" class="btn btn-info btn-lg" data-toggle="modal" id="save_map_btn"
                                data-target="#saveMapModal">Save map</button>
                        </div>

                        <div class="row">
                            Pose estimate: <input type="checkbox" id="show_pose_marker" data-toggle="toggle" />
                            <button type="button" class="btn btn-secondary" onclick="setPoseCall()">Set pose</button>
                        </div>

                        <div class="row">
                            Pick waypoint: <input type="checkbox" id="show_nav_marker" data-toggle="toggle" />
                            <button type="button" id="setwaypointbtn" class="btn btn-secondary" onclick="getPose()"
                                disabled>Setwaypoint</button>
                            <input type="text" id="waypointname" name="wname" onkeyup="setWaypointBtnActivation()">
                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="GaugeMeter" id="GaugeMeter_1" data-width="20" data-total="100"
                                    data-style="Semi" data-showvalue=true>
                                </div>
                            </div>

                        </div>

                        <div class="row">
                            <div class="col">
                                <div class="d-flex justify-content-center" style="width: 210px; height: 210px;">
                                    <div id="joystick"></div>
                                </div>
                            </div>
                        </div>


                    </div>

                    <div id="map3d" class="col-8">
                        <!-- style="background-color: blue;"-->

                    </div>

                    <div class="col-2">
                        <div class="row">

                            <button type="button" class="btn btn-primary" onclick="loadMap()">
                                Reload Map
                            </button>

                            <button type="button" class="btn btn-danger" onclick="deleteAmap()">
                                Delete Map
                            </button>

                        </div>
                        <div class="span3">
                            <table id="mapTable" data-click-to-select="true" data-single-select="true">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true"></th>
                                        <th data-field="name">Map Name</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                        <div class="row">


                            <button type="button" class="btn btn-danger" onclick="deleteAwaypoint()">
                                Delete Waypoint
                            </button>

                        </div>

                        <div class="span5">
                            <tbody id="waypointTable" data-click-to-select="true" data-single-select="true">
                                <thead>
                                    <tr>
                                        <th data-field="state" data-checkbox="true"></th>
                                        <th data-field="name">Waypoint Name</th>
                                    </tr>
                                </thead>
                            </tbody>
                        </div>


                        <!--<button id="set_map_btn" class="btn btn-secondary">set map</button>-->
                        <div class="row">
                            NAV: <input type="checkbox" id="switch_nav" data-toggle="toggle" />
                        </div>
                        <div class="row">
                            <button type="button" class="btn btn-primary" onclick="sendGoal()">
                                Go
                            </button>
                            <div id="nav_status">Satus</div>
                        </div>
                        <div class="row">
                            <canvas id="imuChart" width="1600" height="900"></canvas>
                        </div>

                    </div>
                </div>

            </div>



        </div>


    </div>












    <!-- Modal -->



    <div class="modal fade" id="saveMapModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">Enter map name</h4>
                </div>
                <div class="modal-body">
                    <form role="form">

                        <div class="form-group">
                            <label for="first-name" class="control-label"></label>
                            <input type="text" class="form-control" id="map_name" placeholder="Map name">
                        </div>


                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveMap()"> Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="saveBlockyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">Enter file name</h4>
                </div>
                <div class="modal-body">
                    <form role="form">

                        <div class="form-group">
                            <label for="first-name" class="control-label"></label>
                            <input type="text" class="form-control" id="file_name" placeholder="File name">
                        </div>


                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="cancel-blockly-btn"
                        data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveBlockly()"> Save</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="loadBlockyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                            aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="exampleModalLabel">Choose file</h4>
                </div>
                <div class="modal-body">



                    <div class="container well">
                        <div class="table-responsive"></div>
                        <table class="table" id="filelist">
                        </table>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" id="cancel-load-blockly-btn"
                        data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" disabled="true" id="load-blockly-btn"
                        onclick="loadBlockly()">
                        Load</button>
                </div>

            </div>
        </div>


</body>

</html>